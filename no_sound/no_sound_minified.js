var canvas=document.querySelector("canvas");canvas.width=window.innerWidth,canvas.height=window.innerHeight,cxt=canvas.getContext("2d");var keys={left:!1,right:!1};addEventListener("keydown",a=>{switch(a.code){case"ShiftLeft":keys.left=!0;break;case"ShiftRight":keys.right=!0;}}),addEventListener("keyup",a=>{switch(a.code){case"ShiftLeft":keys.left=!1;break;case"ShiftRight":keys.right=!1;}});var time_survived=0,player={colour:"firebrick",x:window.innerWidth/2,y:500,radius:4,jump_length:10,jump_variation:40,jumped_left:!1,jumped_right:!1,update:function(){!this.jumped_left&&keys.left&&(this.jumped_left=!0,this.x-=this.jump_length+Math.random()*this.jump_variation),!this.jumped_right&&keys.right&&(this.jumped_right=!0,this.x+=this.jump_length+Math.random()*this.jump_variation),this.jumped_left=this.jumped_left&&keys.left,this.jumped_right=this.jumped_right&&keys.right,this.x=Math.max(this.radius,Math.min(this.x,canvas.width-this.radius)),obstacles.forEach(a=>{var b=Math.hypot(this.x-a.x,this.y-a.y),c=this.radius+a.radius;b<=c&&end()})},reset:function(){this.x=window.innerWidth/2,this.y=500}},obstacles=[],density=.01,spawn_delay=100,last_spawn=0;function Obstacle(a,b){this.x=a,this.y=0,this.radius=isNaN(b)||5>b?5:b,this.active=!0}Obstacle.prototype.colour="silver",Obstacle.prototype.speed=function(){return .4+.8/Math.PI*Math.atan(9*(time_survived/6e4-1))},Obstacle.prototype.update=function(a){this.y+=a*this.speed(),this.y>canvas.height&&(this.active=!1)};function draw(){cxt.clearRect(0,0,canvas.width,canvas.height),obstacles.forEach(a=>{cxt.fillStyle=a.colour,cxt.beginPath(),cxt.arc(a.x,a.y,a.radius,0,2*Math.PI),cxt.closePath(),cxt.fill()}),cxt.fillStyle=player.colour,cxt.beginPath(),cxt.arc(player.x,player.y,player.radius,0,2*Math.PI),cxt.closePath(),cxt.fill()}var last_time=null,lapse=0,max_lapse=100,playing=!1;function animate(a){lapse=null==last_time?0:a-last_time,last_time=a,lapse>max_lapse&&(lapse=max_lapse),playing&&(time_survived+=lapse,last_spawn+=lapse,last_spawn>spawn_delay&&(last_spawn=0,obstacles.push(new Obstacle(Math.random()*canvas.width,10))),player.update(lapse),obstacles=obstacles.filter(a=>a.active),obstacles.forEach(a=>{a.update(lapse)}),requestAnimationFrame(animate)),draw()}function start(a){"Shift"==a.key&&(document.getElementById("instructions").style.visibility="hidden",playing=!0,requestAnimationFrame(animate),removeEventListener("keyup",start))}function end(){document.getElementById("instructions").innerHTML="press SHIFT to restart.",document.getElementById("instructions").innerHTML+="<br />score: "+Math.floor(time_survived/1e3),document.getElementById("instructions").style.visibility="visible",playing=!1,cxt.clearRect(0,0,canvas.width,canvas.height),cxt.fillStyle=player.colour,cxt.beginPath(),cxt.arc(player.x,player.y,player.radius,0,2*Math.PI),cxt.closePath(),cxt.fill(),reset(),addEventListener("keyup",start)}function reset(){last_time=null,player.reset(),last_spawn=0,time_survived=0,obstacles=[]}cxt.fillStyle=player.colour,cxt.beginPath(),cxt.arc(player.x,player.y,player.radius,0,2*Math.PI),cxt.closePath(),cxt.fill(),addEventListener("keyup",start);
